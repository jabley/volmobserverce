<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
   <head>
      <meta http-equiv="Content-Type" content="text/xml;charset=UTF-8"/>
      <title>Configuring ICS</title>
      <link rel="stylesheet" href="../volantis.css"/>
   </head>
   <body>
      <h1>Configuring ICS</h1>
      
      <p>You configure ICS by defining the transcoder to use in the
            <span class="filepath">mcs-config.xml</span> file. Then you edit
         the <span class="filepath">ics-config.xml</span> file to suit your
         environment.</p>
      
         
      <h2>Defining the transcoder to use</h2>
         
      <p>MCS includes four types of transcoder plugin.
            ICSWithoutGIF is the default transcoder</p>
         
      <ul>
            
         <li>
               
            <span class="code">com.volantis.mcs.integration.transcoder.ICSWithGIF</span>
               - requests GIFs, requires ICS on JDK 1.4</li>
            
         <li>
               
            <span class="code">com.volantis.mcs.integration.transcoder.ICSWithGIFTransforceCompatibility</span>
               - requests GIFs, requires ICS on JDK 1.4</li>
            
         <li>
               
            <span class="code">com.volantis.mcs.integration.transcoder.ICSWithoutGIF</span>
               - does not request GIFs, does not require ICS on JDK
               1.4</li>
            
         <li>
               
            <span class="code">com.volantis.mcs.integration.transcoder.ICSWithoutGIFTransforceCompatibility</span>-
               does not request GIFs, does not require ICS on JDK
            1.4</li>
         
      </ul>
         
      <p class="note">
         <strong>Note</strong>: These plugins replace three earlier
            versions that do not handle GIF formats. The earlier
            versions are now deprecated, though they continue to be
            supported as aliases for, or subclasses of, the
               <span class="code">WithoutGIF</span> classes.</p>
         
      <p>You configure the transcoder to be used in the
               <span class="code">plugins</span> section of the
               <span class="filepath">mcs-config.xml</span> file.</p>
         
      <pre class="code">&lt;plugins
   url-rewriter="URL_REWRITER_CLASS"
   asset-url-rewriter="ASSET_URL_REWRITE_CLASS"
   asset-transcoder="ASSET_TRANSCODER_CLASS"/&gt;</pre>
         
      <p>This section is initially commented out, with the default
            transcoder class specified. For example, to use the
            TransForce compatibility mode, you should make the
            following entry in the <span class="code">asset-transcoder</span>
            attribute.</p>
         
      <pre class="code">&lt;plugins asset-transcoder= "com.volantis.mcs.integration.transcoder.ICSTransforceCompatibility"/&gt;</pre>
      
      
         
      <h2>Editing the ICS configuration file</h2>
         
      <p>You set the ICS configuration options in the
               <span class="filepath">ics-config.xml</span> file. You can
            specify defaults for the location of images, and how they
            should be transcoded. See <em>ICS configuration parameters</em>
            for details of the parameters.</p>
         
      <p>An <span class="code">init-param</span> element in the
               <span class="filepath">web-xml</span> file gives the path to the
            ICS configuration file. The <span class="code">param-name</span>
            attribute names the file and the <span class="code">param-value</span>
            attribute gives the path information.</p>
         
      <pre class="code">&lt;servlet&gt; 
   &lt;servlet-name&gt;ICS&lt;/servlet-name&gt; 
   &lt;servlet-class&gt;com.volantis.transcoder.Server&lt;/servlet-class&gt; 
      &lt;init-param&gt; 
         &lt;param-name&gt;config.file&lt;/param-name&gt; 
         &lt;param-value&gt;/WEB-INF/ics-config.xml&lt;/param-value&gt;
      &lt;/init-param&gt; 
      ... 
&lt;/servlet&gt; </pre>
         
      <p>The example shows the default entries in the
               <span class="filepath">ics-config.xml</span> file. The host and
            port attributes come from the values you enter when you
            install ICS.</p>
         
      <pre class="code">&lt;transcodingServer&gt;
   &lt;image jpegFormat='baseline' gifSupport='false'&gt;
      &lt;environment serverMode='native'
          imgHost="localhost"
          imgPort="8080"
          maxRedirects="5"
          proxyHost="localhost"
          proxyPort="80"
          log4jConfigurationFile="/WEB-INF/ics-log4j.xml"
          useInMemoryIOCache="false"/&gt;
      &lt;scaling scaleMode='bilinear' scaleLarger='true'/&gt;
      &lt;dithering&gt;
         &lt;dither bitDepth='1' mode='floyd-steinberg' /&gt;
         &lt;dither bitDepth='2' mode='ordered-dither'/&gt;
         &lt;dither bitDepth='4' mode='stucki' /&gt;
         &lt;dither bitDepth='8' mode='jarvis' /&gt;
         &lt;dither bitDepth='16' mode='floyd-steinberg'/&gt;
      &lt;dithering&gt;
      &lt;compression qualityMin='50' paletteMin='4' /&gt;
   &lt;/image&gt;
&lt;/transcodingServer&gt;</pre>
         
      <p class="note">
         <strong>Note</strong>: If you remove the <span class="code">imgHost</span> and
               <span class="code">imgPort</span> attributes, ICS assumes that there
            is an image server running on the same server as ICS (port
            80). If you remove the <span class="code">proxyHost</span> and
               <span class="code">proxyPort</span> attributes, ICS assumes that you
            have not enabled image caching.</p>
      
      
         
      <h2>Proxying</h2>
         
      <p>ICS effectively acts as a proxy between the user agent and
            the server holding the original image, and passes all
            headers from the user agent to the server containing the
            image, with the exception of the accept header.</p>
         
      <p>The accept header is built up of all the media types that
            ICS supports, which may be affected by configuration
            options, for example the <span class="code">gifSupport</span>
            attribute.</p>
      
      
         
      <h2>Caching</h2>
         
      <p>ICS supports the caching of both source and rendered
            images. The caching model obeys HTTP cache control
            directives.</p>
         
      <p>A large image cache is supported that allows memory and
            file-based caching, with migration between levels based on
            usage. Both source and rendered images may be held in the
            same cache, or separate ones may be used.</p>
         
      <p>ICS is configured for file caching by default in the
               <span class="code">useInMemoryIOCache</span> attribute on the
               <span class="code">environment</span> element in the
               <span class="filepath">ics-config.xml</span> file. If the
            attribute is not defined or has any value other than
            'true', file-based caching is enabled. The file-based
            cache has a separate configurable upper size limit of over
            100GB.</p>
         
      <p> A 'true' setting configures a memory cache, and may be
            used to avoid a problem in the Java Image I/O libraries,
            which causes a slow system memory leak at times when ICS
            is transcoding images to GIF format. This memory cache has
            a configurable upper size limit of over 1GB.</p>
         
      <p class="note">
         <strong>Note</strong>: ICS requires the installation of the Squid
            Internet Object Cache server to enable image caching. You
            can obtain Squid from http://www.squid-cache.org/</p>
      
      
         
      <h2>Logging and error handling</h2>
         
      <p>Another <span class="code">init-param</span> element in the
               <span class="filepath">web-xml</span> file gives the path to the
            ICS log configuration file. The <span class="code">param-name</span>
            attribute names the file and the <span class="code">param-value</span>
            attribute gives the path information.</p>
         
      <pre class="code">&lt;init-param&gt; 
   &lt;param-name&gt;ics.log4j.config.file&lt;/param-name&gt; 
   &lt;param-value&gt;/WEB-INF/ics-log4j.xml&lt;/param-value&gt; 
&lt;/init-param&gt; </pre>
         
      <p>The <span class="filepath">ics-log4j.xml</span> file has a path for
            the log file added to it. You may want to change this
            value to a more suitable location.</p>
         
      <p>To do so, edit the path in the <span class="code">value</span>
            attribute in each of the <span class="code">appender</span>
            element sections in the
            <span class="filepath">ics-log4j.xml</span>, which contain a
               <span class="code">param</span> element with a
            <span class="code">name</span> attribute value of 'File'. The example
            shows an instance.</p>
         
      <pre class="code">&lt;appender name="DEFAULT-LOG"
   class="org.apache.log4j.FileAppender"&gt;
   &lt;param name="File"
   value="[path]\MCS\ics\webapps\ics\logs\ics.log"/&gt;
   ...
&lt;/appender&gt; </pre>
         
      <p>ICS logs any remote and local image server failures that
            can arise from a request. If a remote server returns a
            standard HTTP status code, ICS passes it through to the
            client. If the remote server can not be contacted, the 404
            status is passed back.If the local ICS server encounters
            errors when processing the URL request, or performing the
            transcoding operation, an HTTP status of 500 is
         returned.</p>
      
      
         
      <p>
         <span class="ri">Related topics</span>
         <br/>
         <a href="../ics/ics_about.html">About ICS</a>
         <br/>
         <a href="../ics/ics_config_param.html">ICS configuration parameters</a>
         <br/>
         <a href="../ics/ics_override.html">Overriding configuration settings</a>
      </p>
      
   
   </body>
</html>