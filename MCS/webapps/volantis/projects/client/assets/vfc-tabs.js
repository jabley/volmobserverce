
Widget.Tabs=Class.create();Object.extend(Widget.Tabs.prototype,{initialize:function(id,labels,contents,urls,unfoldStyles,images,labelsContentIds,options){this.id=id;this.tabsEl=$(id);this.activeTabIndex=-1;this.activeTabId='';this.contentId='';this.fullScreen=false;this.labels=labels||[];this.urls=urls||[];this.unfoldStyles=unfoldStyles||[];this.labelsContentIds=labelsContentIds||[];this.images=images||[];this.contents=contents||[];Object.copyFields(this,options||{});this.contentEl=$(this.contentId);this.setup();this.select(this.activeTabId);},setup:function(){this.loaded=[];this.urls.each(function(url){this.loaded.push(url==='');}.bind(this));this.activeTabIndex=this.getTabIndex(this.activeTabId);this.contentEl.style.padding='0px';var contentOffsetTop=0;var viewportHeight=0;var contentHeight=0;if(this.fullScreen===true&&Prototype.firefoxBrowser()){contentOffsetTop=Position.cumulativeOffset(this.contentEl)[1];viewportHeight=self.innerHeight||(document.documentElement.clientHeight||document.body.clientHeight);contentHeight=viewportHeight-contentOffsetTop;}
if(contentOffsetTop){this.contentEl.style.height=contentHeight+'px';}
for(var i=0;i<this.labels.length;i++){Widget.addElementObserver($(this.labels[i]),Widget.CLICK,this.showTab.bindAsEventListener(this));}
this.contents.each(function(id){$(id).setStyle({'visibility':'visible','z-index':'0','position':'static','display':'none'});});},showTab:function(evt){var tabId=this.getTabId(Event.element(evt));this.select(tabId);},getTabId:function(element){element=$(element);var tabId=null;do{if(element.id){this.labels.each(function(id,index){if(id==element.id){tabId=this.contents[index];}}.bind(this));}
element=element.parentNode;}while(tabId===null&&element);return tabId;},getTabIndex:function(tabId){var myIndex=-1;this.contents.each(function(id,index){if(id==tabId){myIndex=index;}});return myIndex;},select:function(tabId){this.activeTabEl=$(tabId);var index=this.getTabIndex(tabId);this.load(tabId);if(Element.getStyle(this.activeTabEl,'display')!='none'){return;}
this.hideAll();if(Prototype.nokiaOSSBrowser()||Prototype.firefoxBrowser()||Prototype.operaMobile()){this.contentEl.style.borderBottomStyle=Element.getStyle(this.activeTabEl,'border-bottom-style');this.contentEl.style.borderBottomWidth=Element.getStyle(this.activeTabEl,'border-bottom-width');this.contentEl.style.borderBottomColor=Element.getStyle(this.activeTabEl,'border-bottom-color');this.contentEl.style.borderLeftStyle=Element.getStyle(this.activeTabEl,'border-left-style');this.contentEl.style.borderLeftWidth=Element.getStyle(this.activeTabEl,'border-left-width');this.contentEl.style.borderLeftColor=Element.getStyle(this.activeTabEl,'border-left-color');this.contentEl.style.borderRightStyle=Element.getStyle(this.activeTabEl,'border-right-style');this.contentEl.style.borderRightWidth=Element.getStyle(this.activeTabEl,'border-right-width');this.contentEl.style.borderRightColor=Element.getStyle(this.activeTabEl,'border-right-color');this.activeTabEl.vfcReplaceStyle({'border-left-width':'0px','border-right-width':'0px','border-bottom-width':'0px'});}
this.changeStripBottomBorder(index);this.activeTabEl.style.overflow='hidden';this.activeTabEl.setStyle({'display':'block','overflow':'hidden'});if(Prototype.nokiaOSSBrowser()){var div=document.createElement('div');var parent=this.activeTabEl.parentNode;parent.appendChild(div);parent.removeChild(parent.lastChild);}
if(this.images[index]===false){var stylableLabel=$(this.labels[index]);var borderColor=this.unfoldStyles[index]["background-color"]||Element.getStyle(stylableLabel,'background-color');this.unfoldStyles[index]["border-bottom-color"]=borderColor;if(Prototype.msieBrowser()&&borderColor=='transparent'){this.unfoldStyles[index]["border-bottom-width"]='0px';}
stylableLabel.vfcReplaceStyle($(this.unfoldStyles[index]));}else{this.setActiveImage(index);}
this.activeTabIndex=index;},changeStripBottomBorder:function(index){var labelSelected=$(this.labels[index]);labelSelected.vfcRevertStyle();var borderBottomColor=labelSelected.getStyle("border-bottom-color").parseColor();var borderBottomWidth=labelSelected.getStyle("border-bottom-width").parseColor();var borderBottomStyle=labelSelected.getStyle("border-bottom-style").parseColor();cells=this.tabsEl.firstChild.firstChild.getElementsByTagName("TD");for(var i=0;i<cells.length;i++){var cell=Element.extend(cells[i]);cell.vfcReplaceStyle({'border-bottom-color':borderBottomColor,'border-bottom-width':borderBottomWidth,'border-bottom-style':borderBottomStyle});}},setActiveImage:function(index){var labelEl=$(this.labels[index]);$(this.labelsContentIds[index][0]).style.display='none';$(this.labelsContentIds[index][1]).style.display='inline';},unsetActiveImage:function(index){$(this.labelsContentIds[index][0]).style.display='inline';$(this.labelsContentIds[index][1]).style.display='none';},hideAll:function(){if(Prototype.nokiaOSSBrowser()||Prototype.firefoxBrowser()||Prototype.operaMobile()){this.activeTabEl.vfcRevertStyle();}
this.contents.each(function(id){$(id).setStyle({'display':'none'});});if(this.images[this.activeTabIndex]===false){$(this.labels[this.activeTabIndex]).vfcRevertStyle();}else{this.unsetActiveImage(this.activeTabIndex);}},load:function(tabId){var tabEl=$(tabId);var index=this.getTabIndex(tabId);if(this.loaded[index]===false){new Widget.AjaxUpdater(tabEl,this.urls[index],{asynchronous:true,method:'get'});this.loaded[index]=true;}},reload:function(tabId){var tabEl=$(tabId);var index=this.getTabIndex(tabId);if(this.urls[index]!==''){new Widget.AjaxUpdater(tabEl,this.urls[index],{asynchronous:true,method:'get'});}}});