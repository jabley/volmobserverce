<?xml version="1.0" encoding="UTF-8"?>

<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
   <head>
      <meta content="application/xhtml+xml" http-equiv="Content-Type"/>
      <title>Using databases</title>
      <link rel="stylesheet" href="../volantis.css"/>
   </head>
   <body>
      <h1 class="ocp">Using databases</h1>

      <p>When you use the SQL driver, you define a datasource in the <span class="filepath">mcs-config.xml</span> file. Then you reference this configuration definition from the pipeline XML.</p>
			
      <p>The SQL driver supports three basic pipeline operations with the <span class="code">sqld:query</span>, <span class="code">sqld:modify</span> and <span class="code">sqld:transaction</span> elements.</p>
			
      <p>The first two elements can be given parameters in the form of elements named after appropriate data types, for example <span class="code">sqld:boolean</span> and <span class="code">sqld:timestamp</span>. The transaction element is used to group a number of modification statements.</p>
			
      <p>In each case, the <span class="code">dataSource</span> attribute identifies a valid datasource that is specified in the <span class="filepath">mcs-config.xml</span> file.</p>
			
      <p>The <span class="code">sql</span> attribute on the <span class="code">sqld:query</span> and <span class="code">sqld:modify</span> element specifies the query or modification that is to be applied to the datasource.</p>
		
				
      <pre class="code">&lt;sqld:query 
   dataSource="address"
   sql="select FORENAME, SURNAME from ADDRESSBOOK"/&gt;</pre>
			
		
			
      <h2>Specifying a datasource</h2>
			
      <p>In the <span class="code">pipeline-configuration</span> section of the <span class="filepath">mcs-config.xml</span> file, you can specify multiple data sources in the <span class="code">sql-driver</span> element using the <span class="code">data-sources</span> element as a container.</p>
			
      <p>The <span class="code">name</span> attribute on the <span class="code">named-data-source</span> element identifies the source. The attributes on the <span class="code">jdbc-driver</span>, <span class="code">mcs-database</span> and <span class="code">jndi-data-source</span> elements specify the connection properties for different database types.</p>
			
				
      <pre class="code">&lt;sql-driver&gt;
   &lt;data-sources&gt;
      &lt;named-data-source name="address"&gt;
         &lt;jdbc-driver&gt;
         ...
         &lt;/jdbc-driver&gt;
      &lt;/named-data-source&gt;
   &lt;/data-sources&gt;
&lt;/sql-driver&gt;</pre>

			
      <p>Now you can refer to the datasource.</p>
			
				
      <pre class="code">&lt;sqld:modify
   dataSource="address"
   sql="insert into ADDRESS (FORENAME, SURNAME, ADDRESS) values (?, ?, ?)"&gt;
   &lt;sqld:string value="%{request:getParameterValue('forename')}"/&gt;
   &lt;sqld:string value="%{request:getParameterValue('surname')}"/&gt;
   &lt;sqld:string value="%{request:getParameterValue('address')}"/&gt;
&lt;/sqld:modify&gt;</pre>
			
		
		
			
      <h2>Parameter elements</h2>
			
      <p>SQL driver parameters are elements named for the related data types. They are used in <span class="code">query</span> and <span class="code">modify</span> elements to The value for each type is passed in the <span class="code">value</span> attribute of the element as a string expression, using the pattern <span class="code">\{.*\}</span>.</p>
			
      <p>A complete list of the elements is contained in <em>SQL driver elements</em>.</p>
			
				
      <pre class="code">&lt;sqld:modify
   dataSource="address"
   sql="insert into ADDRESS (FORENAME, SURNAME, ADDRESS) values (?, ?, ?)"&gt;
   &lt;sqld:string value="%{request:getParameterValue('forename')}"/&gt;
   &lt;sqld:string value="%{request:getParameterValue('surname')}"/&gt;
   &lt;sqld:string value="%{request:getParameterValue('address')}"/&gt;
&lt;/sqld:modify&gt;</pre>
		
		
	
		
			
      <h2>Treating a database column as XML</h2>
			
      <p>It is often useful to store XML in a SQL database, and use it in the pipeline as XML, rather than plain text.</p>
			
      <p>Because SQL does not distinguish between the different types of structured data that may be stored in a column, additional information is needed. This information is provided using the <span class="code">column</span> element.</p>
			
      <p>Any number of <span class="code">column</span> elements are allowed in a query, after any parameters. Inside each column the <span class="code">mdc:parseAsXML</span> element contains the information needed by the SQL driver to parse the column values. The <span class="code">parse</span> attribute determines whether the content of the column is treated as en entire document or an XML fragment. The other attributes provide default namespace prefix and URI values for the parsed material.</p>
			
      <p>In the example the abstract column contains markup.</p>
			
				
      <pre class="code">            
&lt;sqld:query
   datasource="PressReleases" 
   sql="select TITLE,ABSTRACT 
      from PRESS_RELEASES 
      where STORY = ?"&gt;
   &lt;sqld:string value="%{request:getParameter('STORY')}"/&gt;
   &lt;sqld:column name="ABSTRACT"&gt;
      &lt;mdc:parseAsXML
         defaultNsPrefix="pr"
         defaultNsURI="http://mycorp.com/schemas/pr"/&gt; 
   &lt;/sqld:column&gt;
    ...
&lt;/sqld:query&gt;</pre>
			
		
		
			
      <p>
         <span class="ri">Related topics</span>
         <br/>
         <a href="../dci/dci_drivers.html">DCI services and drivers</a>
         <br/>
         <a href="../dci/dci_sql_result.html">Query and modification results</a>
         <br/>
         <a href="../dci/dci_sql_transaction.html">Using transactions</a>
         <br/>
         <a href="../dci/dci_mdc.html"> Getting XML from a database</a>
      </p>
		
	
   </body>
</html>