<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE html
  PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html>
<head>
<meta http-equiv="Content-Type" content="text/xml;charset=UTF-8"/>
<meta name="taskref" content="035"/>
<title>Configuring the policy caches</title>
<link rel="stylesheet" href="../volantis.css"/>
</head>
<body>
<h1>Configuring the policy caches</h1>
<p>MCS uses caching in order to avoid accessing the repository for policies that have been retrieved recently. All variants are cached with their containing policies.</p>
<p>You can configure caching in the <span class="code">policy-cache</span> section of the <span class="filepath">mcs-config.xml</span> file by setting global cache values to optimize performance.</p>
<pre class="code">&lt;policy-cache&gt;
   &lt;asset-group-cache
      enabled="true"
      strategy="least-used"
      max-entries="25"
      timeout="3600"/&gt;
      ...
&lt;/policy-cache&gt;</pre>
<h2>Setting cache attributes</h2>
<p>You define cache settings by editing <span class="code">policy-cache</span> attribute values. You can set up values for each type of object, and then switch them on or off with the <span class="code">enabled</span> attribute. On a production server you should set all policy caches to 'true'; on a development server you may wish to switch off some caches so that any changes you make to content are effective immediately.</p>
<p>Each item in the cache has a count that is incremented when MCS accesses the object, and a record of the time of last access. The <span class="code">strategy</span> attribute value uses these count and time values, provided the maximum size of the cache has been reached. If you choose 'least-used', MCS removes the 10 least accessed items. If you choose 'least-recently-used', MCS removes the 10 least recently used items.</p>
<p>The <span class="code">max-entries</span>attribute to defines the number of entries in each cache. If you don't specify a value, or set it to '-1', no size limit is set. Asset groups, images and layouts may need the most space in the policy cache, whereas themes may require a relatively smaller cache. For devices, remember to allow for growth in the device repository.</p>
<p>When an item is requested from the cache MCS checks the <span class="code">timeout</span> attribute, which specifies the number of seconds an item can remain in the cache. If the item has timed out, MCS removes it from the cache and requests the item from the repository. The new item is then cached. This means that, although items may have timed out, they will still exist in the cache until accessed.</p>
<p>You can use the timeout feature to force the cache to update items which may have changed in the repository during run time. It is not intended as a device for resizing the cache after a certain time period. If you don't specify a <span class="code">timeout</span> value, or set it to -1, a cache will be created where none of the items timeout.</p>
<h2>Factors affecting cache size</h2>
<p>There is no exact formula for calculating the size of a cache. It depends on the devices that will be accessing the variants, where they are located in the device tree and how many common ancestors they  have. Generally, the more generic your variants, the larger the cache size needs to be as there will be more fallback entries. Apart from layout and theme caches, cache entries are relatively small, typically 60 bytes. So increasing <span class="code">max-entries</span> will not use large amounts of memory.</p>
<p>The size of layout and theme caches depends on how large and complex the layout or theme is. Each variant accessed causes several entries to be added to the cache, depending on how far MCS has to go back up the fallback chain to get the variant. If the required variant is not found for a particular device, a special entry is stored in the cache to indicate this. Once a variant is found, it is also added to the cache. Depending on the type of variant, MCS will select the best one for the current device. This is also stored in the cache. So, for each variant accessed, there will be one entry for the selected best variant and one entry for each level of fallback, including the actual device.</p>
<p>For example, for an XHTML-Handset device, the fallback chain is Master &gt; Mobile &gt; Handset &gt; XHTML-Handset. If an image variant at Master level in the repository is accessed, it will result in 5 entries being cached (4 for the fallback chain and 1 for the best selected variant). As the variant access goes back up the fallback chain, the respective component needs to be accessed. If a layout at  Master level is also  accessed, an extra 3 entries are added to the cache for the layout at each device in the chain, resulting in 8 entries in total.</p>
<p><span class="ri">Related topics</span><br/>
  <a href="../admin/mcs_configure.html">Configuring MCS</a><br/>
  <a href="../mcs_config/config_policy_cache_elements.html">Policy cache elements</a><br/>
  <a href="../admin/mcs_config_css.html">Controlling stylesheet caching</a></p>
</body>
</html>
