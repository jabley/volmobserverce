
Widget.EffectDesc=Class.create();Object.extend(Widget.EffectDesc.prototype,{name:'none',duration:0,direction:null,fps:25.0,params:null,initialize:function(name,direction,duration,fps,params){this.name=name;this.direction=direction;this.duration=duration;this.fps=fps;this.params=params;}});Widget.EffectRule=Class.create();Object.extend(Widget.EffectRule.prototype,{effectDesc:null,repetitions:'none',activeTime:'none',timeStamp:0,counter:0,initialize:function(desc,reps,time){this.effectDesc=desc;this.repetitions=reps;if(time!='none'){this.activeTime=time*1000;}else{this.activeTime='none';}
this.reset();},reset:function(){if(this.repetitions!='none'){this.counter=0;}else if(this.activeTime!='none'){this.timeStamp=(new Date()).getTime();}},isExpired:function(){var expired=false;if(this.repetitions!='none'){if(this.repetitions<=this.counter){expired=true;}}else if(this.activeTime!='none'){if(this.timeStamp+this.activeTime<(new Date()).getTime()){expired=true;}}
return expired;},update:function(){if(this.repetitions!='none'){this.counter+=1;}}});Widget.Appearable={appRules:[new Widget.EffectRule(new Widget.EffectDesc('none',1,null,25,null),'none','none')],appRuleIdx:0,_nextAppearRule:function(){this.appRuleIdx=(this.appRuleIdx+1+this.appRules.length)%this.appRules.length;var rule=this.appRules[this.appRuleIdx];rule.reset();return rule;},getAppearEffect:function(){var rule=this.appRules[this.appRuleIdx];if(rule.isExpired()){rule=this._nextAppearRule();}
rule.update();if(rule.isExpired()){this._nextAppearRule();}
return rule.effectDesc;}};Widget.Disappearable={disRules:[new Widget.EffectRule(new Widget.EffectDesc('none',1,null,25),'none','none')],disRuleIdx:0,_nextDisappearRule:function(){this.disRuleIdx=(this.disRuleIdx+1+this.disRules.length)%this.disRules.length;var effect=this.disRules[this.disRuleIdx];effect.reset();return effect;},getDisappearEffect:function(){var rule=this.disRules[this.disRuleIdx];if(rule.isExpired()){rule=this._nextDisappearRule();}
rule.update();if(rule.isExpired()){this._nextDisappearRule();}
return rule.effectDesc;}};Widget.Highlightable={time:1,startColor:'#ffff99',endColor:'#ffffff'};Widget.Refreshable={refreshURL:'',refreshInterval:'',usesPolling:true,refreshMode:'PASSIVE',refreshIntervalId:null,startRefresh:function(){if(this.refreshInterval!==""&&this.refreshInterval!==null&&this.refreshURL!==""&&this.refreshURL!==null){this.refreshMode='ACTIVE';this.refreshIntervalId=setInterval(this.forceUpdateOnTimeout.bind(this),this.refreshInterval*1000);}},disableUpdates:function(){if(this.refreshIntervalId!==null)
{clearInterval(this.refreshIntervalId);this.refreshIntervalId=null;}
this.refreshMode='PASSIVE';},forceUpdateOnTimeout:function(){if(!this.usesPolling||Widget.isPollingEnabled()){this.forceUpdate();}},forceUpdate:function(){if(this.refreshMode=="ACTIVE"){if(this.processAJAXResponse&&typeof this.processAJAXResponse=='function'){this.requestId=(this.requestId===null)?0:this.requestId+1;var ar=new Widget.AjaxRequest(this.refreshURL,{method:'get',parameters:{rid:this.requestId},onSuccess:this.processAJAXResponse.bind(this)});}else{this.disableUpdates();}}}};Effect.SlideFromSide=function(element,options){this.element=$(element);var opt=Object.extend({direction:'top'},options||{});Element.cleanWhitespace(this.element);Element.makePositioned(this.element);Element.makePositioned(this.element.firstChild);Element.makeClipping(this.element);element.style.display='block';element.style.visibility='hidden';var dims=element.getDimensions();element.style.display='none';element.style.visibility='visible';var initialMoveX,initialMoveY;var moveX,moveY;switch(options.direction){case'top':initialMoveX=0;initialMoveY=-dims.height;moveX=0;moveY=dims.height;break;case'bottom':initialMoveX=0;initialMoveY=dims.height;moveX=0;moveY=-dims.height;break;case'left':initialMoveX=-dims.width;initialMoveY=0;moveX=dims.width;moveY=0;break;case'right':initialMoveX=dims.width;initialMoveY=0;moveX=-dims.width;moveY=0;break;}
return new Effect.Move(this.element.firstChild,{x:initialMoveX,y:initialMoveY,duration:0.01,beforeSetup:function(effect){effect.element.hide();effect.element.makeClipping();effect.element.makePositioned();},afterFinishInternal:function(effect){new Effect.Move(effect.element,Object.extend({x:moveX,y:moveY,beforeSetup:function(effect){effect.element.parentNode.show();effect.element.show();},afterFinishInternal:function(effect){effect.element.undoClipping();effect.element.parentNode.undoClipping();effect.element.undoPositioned();}},opt));}});};Effect.SlideToSide=function(element,options){this.element=$(element);var opt=Object.extend({direction:'top'},options||{});Element.cleanWhitespace(this.element);Element.makePositioned(this.element);Element.makePositioned(this.element.firstChild);Element.makeClipping(this.element);var dims=this.element.getDimensions();var childDims=this.element.firstChild.getDimensions();var initialMoveX,initialMoveY;var moveX,moveY;switch(opt.direction){case'top':moveX=0;moveY=-dims.height;break;case'bottom':moveX=0;moveY=dims.width;break;case'left':moveX=-dims.width;moveY=0;break;case'right':moveX=dims.width;moveY=0;break;}
return new Effect.Move(this.element.firstChild,Object.extend({x:moveX,y:moveY,afterFinishInternal:function(effect){effect.element.hide();effect.element.parentNode.hide();effect.element.setStyle({left:'0px',top:'0px'});effect.element.show();effect.element.undoClipping();effect.element.undoPositioned();}},opt));};Effect.InstantBase=Class.create();Object.extend(Object.extend(Effect.InstantBase.prototype,Effect.Base.prototype),{initialize:function(element){this.element=$(element);Object.extend(arguments[1],{duration:0});this.start(arguments[1]);},update:function(position){}});Effect.InstantAppear=Class.create();Object.extend(Object.extend(Effect.InstantAppear.prototype,Effect.InstantBase.prototype),{finish:function(position){this.element.show();}});Effect.InstantDisappear=Class.create();Object.extend(Object.extend(Effect.InstantDisappear.prototype,Effect.InstantBase.prototype),{finish:function(position){this.element.hide();}});Widget.TransitionFactory={appearEffects:[{name:"none",direction:null},{name:"grow",direction:"top-left"},{name:"grow",direction:"bottom-left"},{name:"grow",direction:"bottom-right"},{name:"grow",direction:"top-right"},{name:"grow",direction:"center"},{name:"slide",direction:"left"},{name:"slide",direction:"bottom"},{name:"slide",direction:"right"},{name:"slide",direction:"top"},{name:"wipe",direction:"top"},{name:"fade",direction:null},{name:"shake",direction:null},{name:"pulsate",direction:null}],disappearEffects:[{name:"none",direction:null},{name:"shrink",direction:"top-left"},{name:"shrink",direction:"bottom-left"},{name:"shrink",direction:"bottom-right"},{name:"shrink",direction:"top-right"},{name:"shrink",direction:"center"},{name:"slide",direction:"left"},{name:"slide",direction:"bottom"},{name:"slide",direction:"right"},{name:"slide",direction:"top"},{name:"wipe",direction:"top"},{name:"fade",direction:null},{name:"shake",direction:null},{name:"pulsate",direction:null},{name:"puff",direction:null},{name:"dropout",direction:null}],createAppearEffect:function(element,appearable,extensions){var el=$(element);var effectDesc=appearable.getAppearEffect();var effect=new Widget.EffectDesc();Object.extend(effect,effectDesc);Object.extend(effect,extensions);return this._doAppear(el,effect);},createDisappearEffect:function(element,disappearable,extensions){var el=$(element);var effectDesc=disappearable.getDisappearEffect();var effect=new Widget.EffectDesc();Object.extend(effect,effectDesc);Object.extend(effect,extensions);return this._doDisappear(el,effect);},_doAppear:function(el,effect){switch(effect.name)
{case'none':return new Effect.InstantAppear(el,effect);case'fade':return new CustomEffects.AppearEffect(el,effect);case'grow':if(this.supportsScale()){return new CustomEffects.GrowEffect(el,effect);}else{effect.direction='top';return new CustomEffects.SlideAppearEffect(el,effect);}
case'wipe':if(this.supportsWipe()){return new CustomEffects.BlindDownEffect(el,effect);}else{effect.direction='top';return new CustomEffects.SlideAppearEffect(el,effect);}
case'shake':return new CustomEffects.ShakeAppearEffect(el,effect);case'pulsate':return new CustomEffects.AppearPulsateEffect(el,effect);case'slide':return new CustomEffects.SlideAppearEffect(el,effect);case'random':var allowed=(effect.params)?(effect.params.allowed):this.appearEffects;this._makeRandom(effect,allowed);return this._doAppear(el,effect);default:Object.extend(effect,this.appearEffects[0]);return this._doAppear(el,effect);}},_doDisappear:function(el,effect){switch(effect.name)
{case'none':return new Effect.InstantDisappear(el,effect);case'fade':return new CustomEffects.FadeEffect(el,effect);case'shrink':if(this.supportsScale()){return new CustomEffects.ShrinkEffect(el,effect);}else{effect.direction='top';return new CustomEffects.SlideDisppearEffect(el,effect);}
case'puff':return new CustomEffects.PuffEffect(el,effect);case'dropout':return new CustomEffects.DropOutEffect(el,effect);case'wipe':if(this.supportsWipe()){return new CustomEffects.BlindUpEffect(el,effect);}else{effect.direction='top';return new CustomEffects.SlideDisppearEffect(el,effect);}
case'fold':if(this.supportsScale()){return new CustomEffects.FoldEffect(el,effect);}else{effect.direction='top';return new CustomEffects.ShakeDisappearEffect(el,effect);}
case'shake':return new CustomEffects.ShakeDisappearEffect(el,effect);case'pulsate':return new CustomEffects.DisappearPulsateEffect(el,effect);case'slide':return new CustomEffects.SlideDisppearEffect(el,effect);case'random':var allowed=(effect.params)?(effect.params.allowed):this.disappearEffects;this._makeRandom(effect,allowed);return this._doDisappear(el,effect);default:Object.extend(effect,this.disappearEffects[0]);return this._doDisappear(el,effect);}},createHighlightEffect:function(element,highlightable,extension){var el=$(element);var hl=highlightable||{};var ext=extension||{};var opt={duration:hl.time,startcolor:hl.startColor,endcolor:hl.endColor,restorecolor:hl.endColor};return new Effect.Highlight(el,Object.extend(opt,ext));},_makeRandom:function(effect,allowed){var chosen=allowed[Math.floor(Math.random()*allowed.length)];effect.name=chosen.name;effect.direction=(chosen.direction)?(chosen.direction):null;effect.params=(chosen.params)?(chosen.params):null;},supportsScale:function(){return(!Prototype.operaMobile());},supportsWipe:function(){return(this.supportsScale());}};Widget.Internal.EffectBlock=Widget.define(Widget.Appearable,Widget.Disappearable,{appearable:null,disappearable:null,initialize:function(id,options){this.initializeWidget(id,options);this.status=(this.getElement().getStyle("display")=="none")?"hidden":"shown";this.duringTransition=false;this.hidden=(this.status=="hidden");this.getElement().vfcDefaultStyle='block';},show:function(){this.setHidden(false);},hide:function(){this.setHidden(true);},canShow:function(){return this.hidden;},canHide:function(){return!this.hidden;},getStatus:function(){return this.status;},_setStatus:function(status){if(this.status!=status){this.status=status;this.notifyObservers("statusChanged");this.notifyObservers(status);}},isHidden:function(){return this.hidden;},setHidden:function(hidden){setTimeout(this.doSetHidden.bind(this,hidden),0);},doSetHidden:function(hidden){if(this.hidden!=hidden){this.hidden=hidden;if(!this.duringTransition){if(this.hidden){this.startDisappear();}else{this.startAppear();}}
this.notifyObservers('canHideChanged');this.notifyObservers('canShowChanged');this.notifyObservers('isHiddenChanged');}},startDisappear:function(){this._setStatus("hiding");this.duringTransition=true;Widget.TransitionFactory.createDisappearEffect(this.getElement(),this.getDisappearable(),{element:this.getElement(),afterFinish:this.afterDisappear.bind(this)});},afterDisappear:function(){this.duringTransition=false;this._setStatus("hidden");this.checkForAppear();},checkForAppear:function(){if(!this.hidden){this.startAppear();}},startAppear:function(){this.duringTransition=true;this._setStatus("showing");Widget.TransitionFactory.createAppearEffect(this.getElement(),this.getAppearable(),{element:this.getElement(),afterFinish:this.afterAppear.bind(this)});},afterAppear:function(){this.duringTransition=false;this._setStatus("shown");this.checkForDisappear();},checkForDisappear:function(){if(this.hidden){this.startDisappear();}},isDuringTransition:function(){return this.duringTransition;},getAppearable:function(){return(this.appearable===null)?this:this.appearable;},getDisappearable:function(){return(this.disappearable===null)?this:this.disappearable;}});Widget.BlockContent=Widget.define(Widget.Appearable,Widget.Disappearable,{initialize:function(internalContent,options){this.initializeWidget(null,options);this.internalContent=internalContent;var parentBlock=this.getOption("parentBlock");if(parentBlock!==undefined){parentBlock.content=this;parentBlock.displayedContent=this;parentBlock.innerBlock.appearable=this;parentBlock.innerBlock.disappearable=this;}},getInternalContent:function(){return this.internalContent;}});Widget.Block=Widget.define({load:null,fetch:null,refresh:null,initialize:function(outerEffectBlock,innerEffectBlock,blockContainer,options){this.initializeWidget(null,options);if(this.refresh!==null){this.refresh.setOwner(this);this.refresh.startRefresh();}
if(this.load!==null){this.load.setOwner(this);if(this.load.getWhen()=='onload'){this.load.execute();}}
if(this.fetch!==null){this.fetch.setOwner(this);if(this.fetch.getWhen()=='onload'){this.fetch.execute();}}
this.outerBlock=outerEffectBlock;this.innerBlock=innerEffectBlock;this.container=blockContainer;this.displayedContent=this.content;this.contentHidden=false;this.observe(this.outerBlock,"canShowChanged","canShowChanged");this.observe(this.outerBlock,"canHideChanged","canHideChanged");this.observe(this.outerBlock,"hiding","hiding");this.observe(this.outerBlock,"hidden","hidden");this.observe(this.outerBlock,"showing","showing");this.observe(this.outerBlock,"shown","shown");this.observe(this.outerBlock,"statusChanged","statusChanged");this.observe(this.innerBlock,"hiding","innerBlockHiding");this.observe(this.innerBlock,"hidden","innerBlockHidden");this.observe(this.innerBlock,"showing","innerBlockShowing");this.observe(this.innerBlock,"shown","innerBlockShown");this.observe(this.innerBlock,"statusChanged","contentStatusChanged");if(this.getOption("content")!==null){this.setContent(this.getOption("content"));}
this.addAction("show");this.addAction("hide");this.addEvent("hiding");this.addEvent("hidden");this.addEvent("showing");this.addEvent("shown");this.addProperty("status");this.addAction("clear-content");this.addAction("show-content");this.addAction("hide-content");this.addProperty("content",{type:"widget"});this.addProperty("displayed-content",{type:"widget"});this.addEvent("content-hiding");this.addEvent("content-hidden");this.addEvent("content-showing");this.addEvent("content-shown");this.addProperty("content-status");this.addProperty("load",{type:"widget"});this.addProperty("fetch",{type:"widget"});this.addProperty("refresh",{type:"widget"});},getElement:function(){return this.outerBlock.getElement();},show:function(){this.outerBlock.show();},canShow:function(){return this.outerBlock.canShow();},canShowChanged:function(){this.notifyObservers("canShowChanged");},hide:function(){this.outerBlock.hide();},canHide:function(){return this.outerBlock.canHide();},canHideChanged:function(){this.notifyObservers("canHideChanged");},hiding:function(){this.notifyObservers("hiding");},hidden:function(){this.notifyObservers("hidden");},showing:function(){this.notifyObservers("showing");},shown:function(){this.notifyObservers("shown");},getStatus:function(){return this.outerBlock.getStatus();},statusChanged:function(){this.notifyObservers("statusChanged");},setContent:function(content){if(this.content!=content){this.content=content;if(this.innerBlock.getStatus()=="shown"){this.updateInnerBlock();}else if(this.innerBlock.getStatus()=="hidden"){this.updateContainer();this.checkForInnerBlockShow();}
this.notifyObservers("contentChanged");}},getContent:function(){return this.content;},clearContent:function(){this.setContent(null);},hideContent:function(){if(!this.contentHidden){this.contentHidden=true;this.innerBlock.hide();this.canHideContentChanged();this.canShowContentChanged();}},canHideContent:function(){return!this.contentHidden;},canHideContentChanged:function(){this.notifyObservers("canHideContentChanged");},showContent:function(){if(this.contentHidden){this.contentHidden=false;this.checkForInnerBlockShow();this.canHideContentChanged();this.canShowContentChanged();}},canShowContent:function(){return this.contentHidden;},canShowContentChanged:function(){this.notifyObservers("canShowContentChanged");},getDisplayedContent:function(){return this.displayedContent;},getContentStatus:function(){if(this.displayedContent===null){return"none";}else{return this.innerBlock.getStatus();}},contentStatusChanged:function(){this.notifyObservers("contentStatusChanged");},updateDisplayedContent:function(){if(this.displayedContent!==this.content){this.displayedContent=this.content;this.notifyObservers("displayedContentChanged");this.notifyObservers("contentStatusChanged");this.notifyObservers("canShowContentChanged");this.notifyObservers("canHideContentChanged");}},updateInnerBlock:function(){if(this.content!==this.displayedContent){this.innerBlock.hide();}},innerBlockHiding:function(){if(this.displayedContent!==null){this.notifyObservers("contentHiding");this.notifyObservers("contentStatusChanged");}},innerBlockHidden:function(){if(this.displayedContent!==null){this.notifyObservers("contentHidden");this.notifyObservers("contentStatusChanged");}
this.updateContainer();this.checkForInnerBlockShow();},innerBlockShowing:function(){if(this.displayedContent!==null){this.notifyObservers("contentShowing");this.notifyObservers("contentStatusChanged");}},innerBlockShown:function(){if(this.displayedContent!==null){this.notifyObservers("contentShown");this.notifyObservers("contentStatusChanged");}
this.updateInnerBlock();},updateContainer:function(){if(this.content===null){this.container.setContent(null);}else{this.container.setContent(this.content.getInternalContent());}
this.updateDisplayedContent();},checkForInnerBlockShow:function(){if(!this.contentHidden&&this.displayedContent!==null){this.innerBlock.appearable=this.displayedContent;this.innerBlock.disappearable=this.displayedContent;this.innerBlock.show();}},getFetch:function(){return this.fetch;},getLoad:function(){return this.load;},getRefresh:function(){return this.refresh;}});Widget.BlockFetch=Class.define(Widget.Fetch,{initialize:function(options){this.initializeFetch(options);this.load=new Widget.BlockLoad({when:this.when,src:this.prepareRequest()});this.observe(this.load,"succeeded","loadSucceeded");this.observe(this.load,"failed","loadFailed");},doExecute:function(){this.load.setOwner(this.owner);this.load.setSrc(this.prepareRequest());this.load.execute();},prepareRequest:function(){var urlRequest=this.pageBase+this.service+'?src='+escape(this.src);if(this.transformation!==null){urlRequest+='&trans='+escape(this.transformation);}
return urlRequest;},loadSucceeded:function(){this.notifyObservers("succeeded");},loadFailed:function(){this.notifyObservers("failed");}});Widget.BlockLoad=Class.define(Widget.Load,{initialize:function(options){this.initializeLoad(options);},doExecute:function(){this.createAjaxRequest(this.src);},createAjaxRequest:function(requestURL){new Widget.AjaxRequest(requestURL,{method:'get',parameters:'',onSuccess:this.processAJAXResponse.bind(this),onFailure:this.processAJAXFailure.bind(this)});},processAJAXFailure:function(request){this.notifyObservers("failed");},processAJAXResponse:function(request){var responseText=request.responseText;this.getResponseArea().innerHTML=responseText.stripScripts();eval(responseText.extractScripts()[0]);this.owner.setContent(this.blockContent);this.notifyObservers("succeeded");},createResponseArea:function(){var responseArea=document.createElement("div");var responseAreaElement=Element.extend(responseArea);responseAreaElement.setStyle({display:'none'});responseAreaElement.setStyle({visibility:'hidden'});document.body.appendChild(responseArea);return responseAreaElement;},getResponseArea:function(){if(!this.responseArea){this.responseArea=this.createResponseArea();}
return this.responseArea;}});Widget.BlockRefresh=Class.define(Widget.Refresh,Widget.Refreshable,{initialize:function(options){this.initializeRefresh(options);},doExecute:function(){},processAJAXResponse:function(request){var responseText=request.responseText;this.getResponseArea().innerHTML=responseText.stripScripts();eval(responseText.extractScripts()[0]);this.owner.setContent(this.blockContent);this.notifyObservers("succeeded");},createResponseArea:function(){var responseArea=document.createElement("div");var responseAreaElement=Element.extend(responseArea);responseAreaElement.setStyle({display:'none'});responseAreaElement.setStyle({visibility:'hidden'});document.body.appendChild(responseArea);return responseAreaElement;},getResponseArea:function(){if(!this.responseArea){this.responseArea=this.createResponseArea();}
return this.responseArea;}});